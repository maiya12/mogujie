"use strict";var car_content=$(".car_content");$.cookie("login")&&($(".header_login a").text("欢迎"+$.cookie("login")),console.log(1));var username=$.cookie("login");function getData(){$.ajax({url:"../api/getCarData.php",method:"get",data:{username:username},dataType:"json",async:!0,success:function(a){console.log(a),localStorage.setItem("goodsList",JSON.stringify(a)),readData(a),caozuo()}})}function readData(a){var t=shopNum(a),e=' \n    \n    <h3>\n    <span class="active">全部商品</span>\n    <span>优惠</span>\n    <span>库存紧张</span>\n    </h3>\n    <div class="select">\n        <input type="checkbox" > 选项 <span>商品信息</span>\n    </div>\n        <div class="car_product ">\n    ';a.forEach(function(a){e+='\n       <div class="car_product_item clearFix">\n       <div class="car_product_title">\n           <input type="checkbox" class="shopCheck" '+(1==a.is_select?"checked":"")+' goods_id="'+a.goods_id+'">\n           <span>梦范蝶衣 \n                           <img src="../img/chat_03.jpg" alt="">\n                       </span>\n           <i>\n                           <img src="../img/dian_03.jpg" alt="">满80元见减3\n                       </i>\n           <a href=""> <img src="../img/youhuijuan_03.jpg" alt=""></a>\n       </div>\n       <div class="car_product_Text clearFix ">\n           <div class="checkbox">\n               <input type="checkbox" class="productCheck" '+(1==a.is_select?"checked":"")+' goods_id="'+a.goods_id+'" >\n           </div>\n           <div class="productMess ">\n               <img src="'+a.goods_img+'" alt="">\n               <div class="productMessT">\n                   <h4>'+a.goods_name+'</h4>\n               </div>\n\n           </div>\n           <div class="productColor">\n               <p>\n                   <i>颜色</i>\n                   <span>'+a.good_color+"</span>\n               </p>\n               <p>\n                   <i>尺码</i>\n                   <span>"+a.good_size+'</span>\n               </p>\n           </div>\n           <div class="productPrice">\n               <p class="productPM">\n                   ￥'+a.goods_money+'\n               </p>\n               <p class="productPP">\n                   '+a.goods_price+'\n               </p>\n               <p class="productN">\n                   优惠价\n               </p>\n           </div>\n           <div class="productNum" goods_id="'+a.goods_id+'">\n               <span class="minus">-</span>\n               <input type="text" value="'+a.cart_number+'">\n               <span class="add">+</span>\n           </div>\n           <div class="productNp">\n           '+(a.goods_price*a.cart_number).toFixed(2)+'\n           \n           </div>\n           <div class="del" goods_id="'+a.goods_id+'">\n               删除\n           </div>\n       </div>\n   </div>\n       '});var s=a.every(function(a){return 1==a.is_select});e+='\n    </div>\n    <div class="car_footer clearFix">\n    <div class="car_footer_caozuo">\n        <input type="checkbox" id="All" '+(s?"checked":"")+'>\n        <span >全选 </span>\n        <i class="SecondDel">删除</i>\n        <i class="allDel">清空购物车</i>\n        <a> 移入收藏夹</a>\n    </div>\n    <div class="car_pt">\n        <span>共有<i class="totalNum">'+t.totalNum+'</i>件商品，总计：<i class="totalPrice">￥'+t.totalPrice.toFixed(2)+'</i></span>\n        <button class="pay">去付款  ></button>\n    </div>\n</div>\n    ',car_content.html(e)}function caozuo(){car_content.click(function(){var o=window.event;if("productCheck"==o.target.className){var t=o.target.getAttribute("goods_id"),a=JSON.parse(localStorage.getItem("goodsList"));a.forEach(function(a){a.goods_id==t&&(a.is_select=o.target.checked?1:0)}),localStorage.setItem("goodsList",JSON.stringify(a)),readData(a)}if("All"==o.target.id){var e=JSON.parse(localStorage.getItem("goodsList"));e.forEach(function(a){o.target.checked?a.is_select=1:a.is_select=0}),localStorage.setItem("goodsList",JSON.stringify(e)),readData(e),o.target.checked?$(".pay").css("background","#ff5783"):$(".pay").css("background","#d8d8d8")}if("del"==o.target.className){var s=o.target.getAttribute("goods_id");console.log(s);var n=JSON.parse(localStorage.getItem("goodsList")).filter(function(a){return a.goods_id!=s});$.ajax({url:"../api/removeCarData.php",method:"get",data:{username:username,goods_id:s},dataType:"json",async:!0,success:function(a){a.code&&(alert("删除成功"),localStorage.setItem("goodsList",JSON.stringify(n)),readData(n))}})}function c(a){var t=JSON.parse(localStorage.getItem("goodsList")),e=o.target.parentNode.getAttribute("goods_id"),s=t.filter(function(a){return a.goods_id==e})[0],n=1*s.cart_number;"minus"==a?n<=1||n--:n++,$.ajax({url:"../api/updCarData.php",method:"get",data:{username:username,goods_id:e,goods_num:n},dataType:"json",async:!0,success:function(a){1==a.code&&(s.cart_number=n,localStorage.setItem("goodsList",JSON.stringify(t)),readData(t))}})}"allDel"==o.target.className&&$.ajax({url:"../api/clearCarData.php",method:"get",data:{username:username},dataType:"json",async:!0,success:function(a){a.code&&(alert("成功清除购物车"),localStorage.removeItem("goodsList"),location.href="../html/car.html")}}),"minus"==o.target.className&&c(o.target.className),"add"==o.target.className&&c(o.target.className)})}function shopNum(a){var t=a.filter(function(a){return 1==a.is_select});return{totalNum:t.reduce(function(a,t){return a+1*t.cart_number},0),totalPrice:t.reduce(function(a,t){return a+t.goods_price*t.cart_number},0)}}username?($("body").css("background","0"),$(".header").css("opacity","1"),$(".header_nav").css("opacity","1"),$(".footer").css("opacity","1"),$(".sessionk").css("opacity","0"),$(".car_content").css("display","block"),getData()):($(".car").css("height","450"),$(".sure").click(function(){location.href="../html/login.html",localStorage.setItem("url","./car.html")}),$(".close").click(function(){location.href="../html/login.html",localStorage.setItem("url","./car.html")}));